$(document).ready(function(){function a(){var a=document.getElementById("email-address").value,b=document.getElementById("email-address-confirm").value,c=document.getElementById("phone").value,d=document.getElementById("first-name").value,e=document.getElementById("last-name").value,f=document.getElementById("address-1").value,g=document.getElementById("city").value,h=document.getElementById("zip").value,i=document.getElementById("phone").value;if(!(a&&b&&c&&d&&e&&f&&g&&h&&i))return alert("please enter the missing field."),!1;var j=a.match(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/);if(!j)return $("#alert-email-validate").css("display","block"),!1;if($("#alert-email-validate").css("display","none"),a!=b)return $("#alert-email").css("display","block"),!1;$("#alert-email").css("display","none");var k=c.match(/^(\()?\d{3}(\))?(-|\s)?\d{3}(-|\s)?\d{4}$/),l=c.match(/^\d{3}$/);return console.log(l),console.log(k),k||l?($("#alert-phone").css("display","none"),console.log("Yes!"),!0):($("#alert-phone").css("display","block"),!1)}function b(){var a=document.getElementById("email-address").value,b=(document.getElementById("email-address-confirm").value,document.getElementById("first-name").value),c=document.getElementById("last-name").value,d=document.getElementById("address-1").value,f=document.getElementById("address-2").value,g=document.getElementById("city").value,h=document.getElementById("state-select").value,i=document.getElementById("zip").value,j=document.getElementById("phone").value,k="Residential";document.getElementById("commercial").checked&&(k="Commercial");var l=document.getElementById("company").value,m=[];m.push(a),m.push(b),m.push(c),m.push(d),m.push(f),m.push(g),m.push(h),m.push(i),m.push(j),m.push(k),m.push(l),e("form_data",m,7),e("form_saved",!0,7),e("submitted",!0,7);var n=firebase.database();n.ref("users/"+Math.floor(1e5*Math.random())).set({email:a,first_name:b,last_name:c,address_1:d,address_2:f,city:g,state:h,zip:i,residential:k,company:l})}function c(a){var b=a.split(",");console.log(b),$("#part-email").html(b[0]),$("#part-email-confirm").html(b[0]),$("#part-first-name").html(b[1]),$("#part-last-name").html(b[2]),$("#part-address-1").html(b[3]),$("#part-address-2").html(b[4]),$("#part-city").html(b[7]),$("#part-state").html(b[8]),$("#part-zip").html(b[9]),$("#part-phone").html(b[10]),$("#part-shipping").html(b[11]),$("#part-company").html(b[12]),$("#part-submit").html("Thank you for submission")}function d(a){document.getElementById("email-address").value=f("email-address"),document.getElementById("email-address-confirm").value=f("email-address-confirm"),document.getElementById("first-name").value=f("first-name"),document.getElementById("last-name").value=f("last-name"),document.getElementById("address-1").value=f("address-1"),document.getElementById("address-2").value=f("address-2"),document.getElementById("city").value=f("city"),document.getElementById("state-select").value=f("state-select"),document.getElementById("zip").value=f("zip"),document.getElementById("phone").value=f("phone"),document.getElementById("company").value=f("company"),"true"===f("residential")?document.getElementById("residential").checked=!0:(document.getElementById("commercial").checked=!0,$("#shipping-company").css("display","block"))}function e(a,b,c){var d="";if(c){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3),d="; expires="+e.toUTCString()}document.cookie=a+"="+b+d+"; path=/"}function f(a){for(var b=a+"=",c=document.cookie.split(";"),d=0;d<c.length;d++){for(var e=c[d];" "==e.charAt(0);)e=e.substring(1,e.length);if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null}function g(){console.log(navigator.geolocation),navigator.geolocation?navigator.geolocation.getCurrentPosition(h):console.log("Geolocation is not supported by this browser.")}function h(a){console.log(a.coords.latitude+a.coords.longitude),$.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json?latlng="+a.coords.latitude+","+a.coords.longitude+"&key=AIzaSyBGd8HcJ6cBI-oE3ZCWnV0N9fIWsTE2aUY",method:"GET",success:function(a){console.log(a);var b=a.results[0].address_components[4].short_name,c=a.results[0].address_components[3].short_name;console.log(b+" "+c),document.getElementById("city").value=c,document.getElementById("state-select").value=b}})}"true"===f("form_saved")&&("true"===f("submitted")?c(f("form_data")):d(f("form_data"))),"true"!=f("submitted")&&g(),$.ajax({url:"http://www.wsjwine.com/api/offer/responsecode",method:"GET",success:function(a){"0"==a.statusCode&&console.log(a)}});var i=firebase.database().ref("users");i.on("value",function(a){var b="";a.forEach(function(a){var c=a.val();console.log(c),b+="<tr><td>"+c.first_name+"</td><td>"+c.last_name+"</td><td>"+c.email+"</td><td>"+c.city+"</td><td>"+c.state+"</td></tr>"}),$("#table-body").html(b)}),$("#commercial").click(function(){$("#commercial").is(":checked")&&(e("residential","false",7),console.log("the address is "+this.value),$("#shipping-company").css("display","block"))}),$("#residential").click(function(){$("#residential").is(":checked")&&(e("residential","true",7),console.log("the address is "+this.value),$("#shipping-company").css("display","none"))}),$("input").blur(function(){var a="";console.log(this.id+" has finished edit, the value is "+this.value),"residential"!=this.id&&"commercial"!=this.id&&e(this.id,this.value,7),e("form_saved",!0,7),"phone"==this.id?(a=this.value.match(/[^0-9]+/g),a?$("#alert-phone").css("display","block"):$("#alert-phone").css("display","none")):"zip"==this.id?(a=this.value.match(/[^0-9]+/g),a?$("#alert-zip").css("display","block"):($("#alert-zip").css("display","none"),$.ajax({url:"http://www.wsjwine.com/api/user/details",method:"GET",success:function(a){"0"==a.statusCode&&(document.getElementById("city").value=a.response.city),document.getElementById("state-select").value=a.response.stateCode}}))):"email-address"==this.id&&$.ajax({url:"http://www.wsjwine.com/api/address/zipcode/"+this.value,method:"GET",success:function(a){"0"==a.statusCode&&(document.getElementById("city").value=a.response.city),document.getElementById("state-select").value=a.response.stateCode}})}),$("#state-select").change(function(){switch(this.value){case"NY":$("#alert-state-disable").css("display","block"),$("#wine-form-submit").css("display","none");break;case"CA":$("#alert-state-disable").css("display","block"),$("#wine-form-submit").css("display","none");break;case"MA":$("#alert-state-disable").css("display","block"),$("#wine-form-submit").css("display","none");break;default:$("#alert-state-disable").css("display","none"),$("#wine-form-submit").css("display","inline-block")}e(this.id,this.value,7),e("form_saved",!0,7),console.log(this.id+" has finished edit, the value is "+this.value)}),$("#wine-form").submit(function(c){a()&&(b(),location.reload()),c.preventDefault()})});